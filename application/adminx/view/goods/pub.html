<div class="layui-form" lay-filter="layuiadmin-app-form-list" id="layuiadmin-app-form-list">

    <div class="layui-tab">
        <ul class="layui-tab-title">
            <li class="layui-this">通用信息</li>
            <li>商品相册</li>
            <li id="goodsTab">关联商品</li>
            <li>参数规格</li>
            <li>贴心服务</li>
        </ul>
        <div class="layui-tab-content">
            <!--基本信息-->
            <div class="layui-tab-item layui-show">
                <div class="layui-form-item">
                    <label class="layui-form-label">名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="name" lay-verify="required" placeholder="请输入商品名称" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">英文名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="en" lay-verify="required" placeholder="请输入英文名称" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">短名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="short" lay-verify="required" placeholder="20个字内" maxlength="20" class="layui-input">
                    </div>

                    <label class="layui-form-label">特色描述</label>
                    <div class="layui-input-inline">
                        <input type="text" name="say" placeholder="15个字内" maxlength="15" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">关键词</label>
                    <div class="layui-input-block">
                        <input type="text" name="keyword" class="layui-input">
                    </div>
                </div>  

                <div class="layui-form-item">
                    <label class="layui-form-label">描述</label>
                    <div class="layui-input-block">
                        <input type="text" name="intr" placeholder="一句话描述商品" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">图片</label>
                    <div class="layui-input-inline" style="width:400px">
                        <input type="text" id="picname" name="picname" class="layui-input">
                    </div>
                    <div class="layui-inline">
                        <button type="button" class="layui-btn" id="upload-single">上传图片</button>
                        <i class="layui-icon showImage" tag="picname">&#xe64a;</i>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">分类一</label>
                    <div class="layui-input-inline">
                        <select name="cid" id="cid" lay-verify="required">
                        <option value="">==请选择==</option>
                        {volist name="cate" id="vo"}
                        <option value="{$vo['id']},{$vo['path']}">{php}
                            for($i=0; $i<$vo['count']*2; $i++){
                               echo '&nbsp;&nbsp;';            
                            }
                        {/php}{$vo['name']}</option>
                        {/volist}
                        </select>
                    </div>
                    <label class="layui-form-label">分类二</label>
                    <div class="layui-input-inline">
                        <select name="cid1" id="cid1">
                        <option value="">==请选择==</option>
                        {volist name="cate" id="vo"}
                        <option value="{$vo['id']},{$vo['path']}">{php}
                            for($i=0; $i<$vo['count']*2; $i++){
                               echo '&nbsp;&nbsp;';            
                            }
                        {/php}{$vo['name']}</option>
                        {/volist}
                        </select>
                    </div>

                    <label class="layui-form-label">排序</label>
                    <div class="layui-input-inline">
                        <input type="text" name="sort" id="sort" value="50" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">品牌</label>
                    <div class="layui-input-inline">
                        <select name="brandID" class="fsSelect fsDict" lay-verify="required" dict="brand" addNull="1">
                        </select>
                    </div>

                    <label class="layui-form-label">包裹类型</label>
                    <div class="layui-input-inline">
                        <select name="typeID" class="fsSelect fsDict" lay-verify="required" dict="baoguo" addNull="1">
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">状态</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="show" value="1" title="显示" checked="checked">
                        <input type="radio" name="show" value="0" title="隐藏">
                    </div>

                    <label class="layui-form-label">首页显示</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="comm" value="1" title="是">
                        <input type="radio" name="comm" value="0" title="否" checked="checked">
                    </div>  

                    <label class="layui-form-label">限库存</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="empty" value="1" title="是">
                        <input type="radio" name="empty" value="0" title="否" checked="checked">
                    </div>
                </div>      

                <div class="layui-form-item"> 
                    <label class="layui-form-label">价格</label>
                    <div class="layui-input-inline">
                        <input type="text" name="price" lay-verify="required" autocomplete="off" class="layui-input" />
                    </div>

                    <label class="layui-form-label">会员价</label>
                    <div class="layui-input-inline">
                        <input type="text" name="price1" lay-verify="required" autocomplete="off" class="layui-input" />
                    </div>

                    <label class="layui-form-label">进价</label>
                    <div class="layui-input-inline">
                        <input type="text" name="inprice" lay-verify="required" autocomplete="off" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">商品重量</label>
                    <div class="layui-input-inline">
                        <input type="text" name="weight" lay-verify="required" autocomplete="off" class="layui-input" />
                    </div>

                    <label class="layui-form-label">物流重量</label>
                    <div class="layui-input-inline">
                        <input type="text" name="wuliuWeight" lay-verify="required" autocomplete="off" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">保质期</label>
                    <div class="layui-input-inline">
                        <input type="text" name="endDate" id="endDate" class="layui-input">
                    </div>

                    <label class="layui-form-label">初始销量</label>
                    <div class="layui-input-inline">
                        <input type="text" name="sellNumber" value="0" class="layui-input">
                    </div>

                    <label class="layui-form-label">网站库存</label>
                    <div class="layui-input-inline">
                        <input type="text" name="stock" id="stock" value="999" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">单品数量</label>
                    <div class="layui-input-inline">
                        <input type="text" name="number" id="number" value="1" class="layui-input">
                    </div>

                    <label class="layui-form-label">包邮</label>
                    <div class="layui-input-inline">
                        <select name="wuliu">
                            <option value="">无</option>
                            {volist name="wuliu" id="vo"}
                            <option value="{$vo.name}">{$vo.name}</option>
                            {/volist}
                        </select>
                    </div>

                    <label class="layui-form-label">水印</label>
                    <div class="layui-input-inline">
                        <select name="tag" id="tag">
                            <option value="">无</option>
                            {volist name="tag" id="vo"}
                            <option value="{$vo.id}">{$vo.name}</option>
                            {/volist}
                        </select>
                    </div>  
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">正文</label>
                    <div class="layui-input-block">
                        <textarea name="content" id="container" lay-verify="content">{$list.content}</textarea>
                    </div>
                </div>
            </div>

            <!--相册-->
            <div class="layui-tab-item">
                <div class="insert-img" id="insert-img">
                    <a href="javascript:;" class="insert-btn" id="upload-mult">+</a> 
                </div>              
            </div>

            <!--关联商品-->
            <div class="layui-tab-item">
                <div class="layui-row layui-col-space5">
                    <div class="layui-col-md12">                        
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input type="text" id="keyword" name="keyword" autocomplete="off" placeholder="名称" class="layui-input"/>
                            </div>
                            <div class="layui-inline">
                                <button class="layui-btn" type="button" id="goods-search">
                                    <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md6">
                        <table id="goodsTable" lay-filter="goodsTable"></table>
                    </div>
                    <div class="layui-col-md6">
                        <table id="resultTable" lay-filter="resultTable"></table>
                        <table class="layui-table">        
                            <tbody id="specBox">
                                <tr>
                                    <td style="width: 80px">图片</td>
                                    <td>名称</td>
                                    <td style="width: 60px">操作</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
      

            <!--参数规格-->
            <div class="layui-tab-item">
                <div class="layui-row">
                    {volist name="attr" id="vo"}    
                    <div class="layui-col-md3">
                        <label class="layui-form-label">{$vo.name}</label>
                        <div class="layui-input-inline">
                            <select name="attr_{$vo.id}[]">
                                <option value="">无</option>
                                {volist name="vo.item" id="f"}
                                <option value="{$f}">{$f}</option>
                                {/volist}
                            </select>
                        </div>
                    </div>
                    {/volist}
                </div>

                <div class="layui-row" style="margin-top: 10px">
                    <div class="layui-col-md12">                        
                        <textarea name="extends" class="layui-textarea">{$list.extends}</textarea>
                        <p>扩展参数，一行代表一个可选项</p>                    
                    </div>
                </div>
            </div>

            <!--贴心服务-->
            <div class="layui-tab-item">                
                {volist name="server" id="vo"}          
                <p style="padding: 10px 0"><input type="checkbox" name="server[]" lay-skin="primary" title="{$vo.name}" value="{$vo.id}"></p>
                {/volist}
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-hide">
        <input type="button" lay-submit lay-filter="lay-common-submit" id="lay-common-submit" value="确认添加" iframe="1" url="{:url('goods/pub')}">
    </div>
    <input type="hidden" name="id" value="{$list.id}">
    <input type="hidden" name="linkIds" value="{$list.linkIds}">
</div>
<script src="{:RES}/tinymce/tinymce.min.js"></script>
<script>
layui.config({
    base: '{:RES}/' //静态资源所在路径
}).extend({
    index: 'lib/index' //主入口模块
}).use(['index','myupload','tinymce','table'], function() {    
    var $ = layui.$,
        table = layui.table,
        myupload = layui.myupload,
        tinyConfig = layui.tinymce,
        goods = [];

    $("html").css({"background":"#fff"});
    tinymce.init(tinyConfig);

    $("#lay-common-submit").click(function(){
        $("#container").val(tinyMCE.activeEditor.getContent());
    })

    myupload.single({
        elem : '#upload-single',
        url : '{:url('upload/image')}',
        ext:'jpg|png|gif|jpeg',
        mime:'image/*',
        size:5120,
        tag : '#picname'
    }); 

    myupload.mult({
        elem : '#upload-mult',
        url : '{:url('upload/image')}',
        ext:'jpg|png|gif|jpeg',
        mime:'image/*',
        size:5120
    });     

    //监听行单击事件（单击事件为：rowDouble）
    table.on('row(goodsTable)', function(obj){
        var data = obj.data;
        for (var i = 0; i < goods.length; i++) {
            if(data.id == goods[i]['id']){
                return false;
            }       
        }
        goods.push(data);
        setData();
    });

    //监听行工具事件
    table.on('tool(resultTable)', function(obj){
        var data = obj.data;        
        if(obj.event === 'del'){
            temp = [];
            for (var i = 0; i < goods.length; i++) {
                if(data.id != goods[i]['id']){
                    temp.push(goods[i]);
                }
            }
            goods = temp;
            setData();
        }
    });

    function getData(){
        table.render({
            elem: '#goodsTable',
            url: '{:url('goods/index')}', //数据接口
            method:'post',
            where: {keyword:$("#keyword").val()},
            page: true, //开启分页
            cols: [[ //表头
                {field: 'picname', title: '图片' , width: 80 , templet:'#imageTpl'},
                {field: 'name', title: '名称'},
            ]]
        });
    };

    function setData(){
        table.render({
            elem: '#resultTable',
            data:goods,
            cols: [[ //表头
                {field: 'picname', title: '图片' , width: 80 , templet:'#imageTpl'},
                {field: 'name', title: '名称'},
                {fixed: 'right', title:'操作', toolbar: '#barDemo', width:60},
            ]]
        });
    };

    $("#goodsTab").click(function(){
        getData();
    });

    $("#goods-search").click(function(){
        var keyword = $("#keyword").val();
        if(keyword!=''){
            getData();
        }
    })  
})
</script>
<script type="text/html" id="imageTpl">
    <img src="{{d.picname}}" style="height: 40px;" />
</script>
<script type="text/html" id="barDemo">
    <a href="javascript:void(0)" lay-event="del" class="layui-btn layui-btn-primary layui-btn-xs"><i class="layui-icon layui-icon-delete"></i></a>
</script>